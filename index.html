<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>MSE-Sync Dashboard</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 20px;
                background: #f5f5f5;
            }

            .container {
                max-width: 1200px;
                margin: 0 auto;
            }

            .card {
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                margin-bottom: 20px;
            }

            .peer {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px;
                border-bottom: 1px solid #eee;
            }

            .peer:last-child {
                border-bottom: none;
            }

            .status {
                width: 10px;
                height: 10px;
                border-radius: 50%;
                display: inline-block;
                margin-right: 10px;
            }

            .online {
                background: #4caf50;
            }

            .offline {
                background: #f44336;
            }

            .files {
                font-size: 0.9em;
                color: #666;
                margin-top: 5px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>MSE-Sync Dashboard</h1>

            <div class="card">
                <h2>Connected Peers</h2>
                <div id="peers"></div>
            </div>

            <div class="card">
                <h2>Sync Activity</h2>
                <div id="activity"></div>
            </div>
        </div>

        <script src="/socket.io/socket.io.js"></script>
        <script>
            const socket = io();
            const peersDiv = document.getElementById("peers");
            const activityDiv = document.getElementById("activity");

            function formatTime(timestamp) {
                return new Date(timestamp).toLocaleString();
            }

            function updatePeers(peers) {
                peersDiv.innerHTML = peers
                    .map(
                        (peer) => `
                <div class="peer">
                    <div>
                        <span class="status ${
                            Date.now() - peer.lastSeen < 30000
                                ? "online"
                                : "offline"
                        }"></span>
                        ${peer.id}
                        <div class="files">
                            Files: ${peer.files
                                .map(([name, hash]) => name)
                                .join(", ")}
                        </div>
                    </div>
                    <div>
                        Last seen: ${formatTime(peer.lastSeen)}
                    </div>
                </div>
            `
                    )
                    .join("");
            }

            function addActivity(event) {
                const div = document.createElement("div");
                div.className = "peer";
                div.innerHTML = `
                <div>
                    ${event.peerId}: ${event.type} - ${
                    event.filename || "System event"
                }
                </div>
                <div>
                    ${formatTime(event.timestamp)}
                </div>
            `;
                activityDiv.insertBefore(div, activityDiv.firstChild);

                // Keep only last 50 events
                while (activityDiv.children.length > 50) {
                    activityDiv.removeChild(activityDiv.lastChild);
                }
            }

            socket.on("dashboard-update", (update) => {
                updatePeers(update.peers);
            });

            socket.on("sync-event", (event) => {
                addActivity(event);
            });
        </script>
    </body>
</html>
